{"version":3,"sources":["meteor://ðŸ’»app/server/collections.js"],"names":[],"mappings":"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","file":"/server/collections.js","sourcesContent":["Rooms.deny({\n    insert: function (userId, doc) {\n        return true;\n    },\n    remove: function (userId, doc) {\n        return true;\n    }\n});\nMessages.deny({\n    insert: function (userId, doc) {\n        return (userId === null);\n    }\n});\nMessages.allow({\n    insert: function (userId, doc) {\n        return (userId !== null);\n    }\n});\n\nImages.allow({\n    insert: function () {\n        return true;\n    },\n    update: function () {\n        return true;\n    },\n    remove: function () {\n        return true;\n    }\n});\nMeteor.publish(\"users\", function (location) {\n    return Meteor.users.find({});\n});\nMeteor.publish(\"images\", function () {\n    return Images.find();\n});\n\nMeteor.publish(\"rooms\", function (location) {\n    return Rooms.find({location: location});\n});\nMeteor.publish(\"messages\", function (location) {\n    return Messages.find({location: location}, {sort: {ts: -1}});\n});\nMeteor.publish(\"location\", function () {\n    return Location.find({});\n});\n\nMeteor.methods({\n    \"createRoom\": function (owner, guest, location) {\n        var room = Rooms.findOne({\n            users: {\n                $all: [{\n                    username: owner.username,\n                    profilename: owner.profile.profilename\n                }, {username: guest.username, profilename: guest.profile.profilename}]\n            }\n        }) ;\n        if (room == undefined) {\n            roomname = new Meteor.Collection.ObjectID().valueOf();\n            Rooms.insert({\n                roomname: roomname,\n                users: [{username: owner.username, profilename: owner.profile.profilename}, {\n                    username: guest.username,\n                    profilename: guest.profile.profilename\n                }],\n                location: location\n            });\n            Meteor.users.update(owner._id, {$push: {\"profile.rooms\": {roomname: roomname}}});\n            Meteor.users.update(guest._id, {$push: {\"profile.rooms\": {roomname: roomname}}})\n            return roomname;\n        } else {\n            return room.roomname;\n        }\n\n    },\n    \"removeUser\": function (userid) {\n        //Meteor.users.remove({_id: userid});\n        Meteor.users.update(userid, { $set: {\"profile.online\": false} } );\n\n    }\n});\n\n"]}